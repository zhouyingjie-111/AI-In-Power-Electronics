<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root { 
            color-scheme: light; 
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #ffffff;
            border-bottom: 1px solid #d0d0d0;
            padding: 20px 0;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            background: linear-gradient(135deg, #3a86ff, #7a5cff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            margin: 10px 0 0 0;
            color: #666666;
            font-size: 1.1em;
        }

        .container {
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
            width: 100%;
        }

        .tabs {
            display: flex;
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 30px;
            gap: 8px;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            background: transparent;
            font-size: 1em;
            border-radius: 8px;
            transition: all 0.3s;
            color: #666666;
        }

        .tab:hover {
            background: #f5f5f5;
            color: #1a1a1a;
        }

        .tab.active {
            background: #ffffff;
            color: #1a1a1a;
            font-weight: 600;
            border: 1px solid #d0d0d0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .control-panel {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #d0d0d0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a1a1a;
            font-size: 0.9em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            font-size: 1em;
            background: #ffffff;
            color: #1a1a1a;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3a86ff;
        }

        .btn {
            padding: 10px 20px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
            background: #ffffff;
            color: #1a1a1a;
        }

        .btn-primary {
            background: #ffffff;
            color: #1a1a1a;
            border: 1px solid #d0d0d0;
        }

        .btn-primary:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-success {
            background: #ffffff;
            color: #1a1a1a;
            border: 1px solid #d0d0d0;
        }

        .btn-success:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: #ffffff;
            color: #1a1a1a;
            border: 1px solid #d0d0d0;
        }

        .btn-danger:hover {
            background: #f5f5f5;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-warning {
            background: #ffffff;
            color: #1a1a1a;
            border: 1px solid #d0d0d0;
        }

        .btn-warning:hover {
            background: #f5f5f5;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .data-card {
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            overflow: hidden;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #d0d0d0;
        }

        .file-info h3 {
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .column-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .column-tag {
            background: #e8e8e8;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #666666;
        }

        .data-table-container {
            overflow-x: auto;
            max-height: 600px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: linear-gradient(135deg, #3a86ff, #7a5cff);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e8e8e8;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85em;
            white-space: nowrap;
        }

        .btn-sm:hover {
            transform: translateY(-1px);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #d0d0d0;
            background: #ffffff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            color: #666666;
        }

        .pagination button:hover:not(:disabled) {
            background: #f5f5f5;
            color: #1a1a1a;
            border-color: #d0d0d0;
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination .page-info {
            padding: 8px 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8e8e8;
        }

        .modal-header h2 {
            background: linear-gradient(135deg, #3a86ff, #7a5cff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal .form-group {
            margin-bottom: 20px;
        }

        .modal .form-group input,
        .modal .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .modal .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(58, 134, 255, 0.15);
        }

        .stat-card h3 {
            color: #1a1a1a;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e8e8e8;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666666;
        }

        .stat-value {
            font-weight: 600;
            color: #3a86ff;
        }

        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
            animation: slideDown 0.3s;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3a86ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-list {
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .file-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .file-item:hover {
            background: #f8f9fa;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item input[type="checkbox"] {
            margin-right: 12px;
        }

        .file-info-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-name {
            font-weight: 600;
            color: #1a1a1a;
        }

        .file-meta {
            font-size: 0.85em;
            color: #666666;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .import-export-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .import-export-card {
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            padding: 25px;
        }

        .import-export-card h3 {
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .file-upload {
            border: 2px dashed #d0d0d0;
            padding: 30px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 15px 0;
        }

        .file-upload:hover {
            border-color: #3a86ff;
            background: rgba(58, 134, 255, 0.05);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .logout-btn {
            background: none;
            border: 1px solid #d0d0d0;
            color: #1a1a1a;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #f5f5f5;
            border-color: #3a86ff;
            color: #3a86ff;
        }

        @media (max-width: 768px) {
            .import-export-grid {
                grid-template-columns: 1fr;
            }

            .control-panel {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
            }

            .tabs {
                flex-direction: column;
            }

            .logout-btn {
                position: relative !important;
                top: auto !important;
                left: auto !important;
                margin: 10px auto;
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>æ•°æ®æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h1>
        <p>AI-based Optimized Design - Data Management</p>
        <button class="logout-btn" onclick="goToMain()" style="position: absolute; top: 20px; left: 30px;">
            â† è¿”å›ä¸»å¹³å°
        </button>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('data-manager')">æ•°æ®ç®¡ç†</button>
            <button class="tab" onclick="switchTab('import-export')">å¯¼å…¥/å¯¼å‡º</button>
            <button class="tab" onclick="switchTab('statistics')">æ–‡ä»¶ç»Ÿè®¡</button>
            <button class="tab" onclick="switchTab('cleanup')">æ–‡ä»¶æ¸…ç†</button>
        </div>

        <!-- æ•°æ®ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="data-manager" class="tab-content active">
            <div id="alert-container"></div>
            
            <div class="control-panel">
                <div class="form-group">
                    <label for="file-selector">é€‰æ‹©æ–‡ä»¶:</label>
                    <select id="file-selector" onchange="onFileChange()">
                        <option value="">-- é€‰æ‹©CSVæ–‡ä»¶ --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="search-input">æœç´¢:</label>
                    <input type="text" id="search-input" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." onkeyup="onSearch()">
                </div>

                <button class="btn btn-success" onclick="showAddRecordModal()" style="margin-top: 23px;">
                    â• æ·»åŠ è®°å½•
                </button>

                <button class="btn btn-primary" onclick="refreshData()" style="margin-top: 23px;">
                    ğŸ”„ åˆ·æ–°
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>åŠ è½½ä¸­...</p>
            </div>

            <div id="data-container">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>è¯·é€‰æ‹©ä¸€ä¸ªCSVæ–‡ä»¶å¼€å§‹ç®¡ç†</p>
                </div>
            </div>

            <div class="pagination" id="pagination" style="display: none;">
                <!-- åˆ†é¡µæ§ä»¶ -->
            </div>
        </div>

        <!-- å¯¼å…¥/å¯¼å‡ºæ ‡ç­¾é¡µ -->
        <div id="import-export" class="tab-content">
            <div class="import-export-grid">
                <div class="import-export-card">
                    <h3>ğŸ“¥ å¯¼å…¥æ•°æ®</h3>
                    <div class="form-group">
                        <label>é€‰æ‹©ç›®æ ‡æ–‡ä»¶:</label>
                        <select id="import-file-select">
                            <option value="">-- é€‰æ‹©æ–‡ä»¶ --</option>
                        </select>
                    </div>

                    <div class="file-upload" onclick="document.getElementById('csv-file-input').click()">
                        <input type="file" id="csv-file-input" accept=".csv" onchange="handleFileSelect(event)">
                        <p>ğŸ“ ç‚¹å‡»é€‰æ‹©CSVæ–‡ä»¶</p>
                        <p style="color: #666; font-size: 0.9em; margin-top: 10px;">æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <p id="selected-file" style="color: #3a86ff; font-weight: bold; margin-top: 10px;"></p>
                    </div>

                    <p style="color: #ff6b6b; font-size: 0.9em; margin-bottom: 15px;">
                        âš ï¸ å¯¼å…¥å°†è¦†ç›–åŸæ–‡ä»¶ï¼Œè¯·ç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´ï¼åŸæ–‡ä»¶ä¼šè‡ªåŠ¨å¤‡ä»½ã€‚
                    </p>

                    <button class="btn btn-success" onclick="importCSV()" style="width: 100%;">
                        ğŸ“¤ å¯¼å…¥æ•°æ®
                    </button>
                </div>

                <div class="import-export-card">
                    <h3>ğŸ“¤ å¯¼å‡ºæ•°æ®</h3>
                    <div class="form-group">
                        <label>é€‰æ‹©è¦å¯¼å‡ºçš„æ–‡ä»¶:</label>
                        <select id="export-file-select">
                            <option value="">-- é€‰æ‹©æ–‡ä»¶ --</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="exportCSV()" style="width: 100%; margin-top: 30px;">
                        ğŸ’¾ å¯¼å‡ºä¸ºCSV
                    </button>

                    <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #e8e8e8;">
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                            ğŸ“‹ å¯¼å‡ºçš„æ–‡ä»¶å°†ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶ç»Ÿè®¡æ ‡ç­¾é¡µ -->
        <div id="statistics" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯</h2>
                <button class="btn btn-primary" onclick="loadStatistics()">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
            </div>
            
            <div id="stats-container" class="stats-grid">
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            </div>
        </div>

        <!-- æ–‡ä»¶æ¸…ç†æ ‡ç­¾é¡µ -->
        <div id="cleanup" class="tab-content">
            <div class="data-card" style="margin-bottom: 30px;">
                <div class="file-info">
                    <h3>ğŸ—‘ï¸ æ¸…ç†æ—§æ–‡ä»¶</h3>
                    <p style="color: #666; margin-top: 10px;">æ‰«æå¹¶åˆ é™¤è¶…è¿‡æŒ‡å®šæ—¶é—´æœªä¿®æ”¹çš„æ–‡ä»¶</p>
                </div>
                <div style="padding: 25px;">
                    <div class="form-group">
                        <label>é€‰æ‹©æ—¶é—´èŒƒå›´:</label>
                        <select id="cleanup-period">
                            <option value="week">ä¸€å‘¨</option>
                            <option value="month" selected>ä¸€æœˆ</option>
                            <option value="half_year">åŠå¹´</option>
                            <option value="year">ä¸€å¹´</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="scanOldFiles()">ğŸ” æ‰«ææ—§æ–‡ä»¶</button>
                        <button class="btn btn-danger" onclick="deleteSelectedFiles()">ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­æ–‡ä»¶</button>
                    </div>
                </div>
            </div>

            <div class="data-card" style="margin-bottom: 30px;">
                <div class="file-info">
                    <h3>ğŸ”§ æ£€æŸ¥æŸåæ–‡ä»¶</h3>
                    <p style="color: #666; margin-top: 10px;">æ£€æŸ¥æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ˜¯å¦æŸåæˆ–æ ¼å¼é”™è¯¯</p>
                    <p style="color: #999; margin-top: 5px; font-size: 0.9em;">æ”¯æŒæ£€æµ‹ï¼šCSVã€JSONã€Pythonã€MATLABã€å›¾ç‰‡ã€å‹ç¼©åŒ…ã€æ¨¡å‹æ–‡ä»¶ç­‰</p>
                </div>
                <div style="padding: 25px;">
                    <button class="btn btn-warning" onclick="checkCorruptedFiles()">ğŸ” å¼€å§‹å…¨é¢æ£€æŸ¥</button>
                    <p style="color: #999; margin-top: 10px; font-size: 0.9em;">âš ï¸ æ­¤æ“ä½œä¼šæ‰«ææ•´ä¸ªé¡¹ç›®ç›®å½•ï¼Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´</p>
                </div>
            </div>

            <div id="cleanup-results"></div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘è®°å½•æ¨¡æ€æ¡† -->
    <div id="record-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">æ·»åŠ è®°å½•</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="record-form">
                <div id="form-fields"></div>
                <div class="action-buttons" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ğŸ’¾ ä¿å­˜</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal()" style="flex: 1;">âŒ å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentFile = '';
        let currentPage = 1;
        let perPage = 50;
        let searchQuery = '';
        let currentEditIndex = null;
        let scannedFiles = [];

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            loadFiles();
            loadStatistics();
            checkUserPermissions();
        });

        // æ£€æŸ¥ç”¨æˆ·æƒé™
        function checkUserPermissions() {
            // ä»é¡µé¢ä¸­è·å–ç”¨æˆ·è§’è‰²ä¿¡æ¯ï¼ˆé€šè¿‡æ¨¡æ¿å˜é‡ï¼‰
            const userRole = '{{ session.role if session.role else "user" }}';
            const isAdmin = userRole === 'admin';
            
            // å¦‚æœä¸æ˜¯ç®¡ç†å‘˜ï¼Œéšè—ç¼–è¾‘ç›¸å…³åŠŸèƒ½
            if (!isAdmin) {
                // éšè—æ·»åŠ è®°å½•æŒ‰é’®
                const addButton = document.querySelector('button[onclick="showAddRecordModal()"]');
                if (addButton) {
                    addButton.style.display = 'none';
                }
                
                // éšè—å¯¼å…¥æŒ‰é’®
                const importButton = document.querySelector('button[onclick="importCSV()"]');
                if (importButton) {
                    importButton.style.display = 'none';
                }
                
                // éšè—å¯¼å‡ºæŒ‰é’®
                const exportButton = document.querySelector('button[onclick="exportCSV()"]');
                if (exportButton) {
                    exportButton.style.display = 'none';
                }
                
                // éšè—å¯¼å…¥/å¯¼å‡ºæ ‡ç­¾é¡µ
                const importExportTab = document.querySelector('button[onclick="switchTab(\'import-export\')"]');
                if (importExportTab) {
                    importExportTab.style.display = 'none';
                }
                
                // éšè—æ–‡ä»¶æ¸…ç†åŠŸèƒ½
                const cleanupTab = document.querySelector('button[onclick="switchTab(\'cleanup\')"]');
                if (cleanupTab) {
                    cleanupTab.style.display = 'none';
                }
                
                // æ˜¾ç¤ºæƒé™æç¤º
                const header = document.querySelector('.header p');
                if (header) {
                    header.innerHTML += '<br><span style="color: #ff6b6b; font-size: 0.9em;">ğŸ”’ æ™®é€šç”¨æˆ·æ¨¡å¼ï¼šä»…å¯æŸ¥çœ‹æ•°æ®</span>';
                }
            }
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // è¿”å›ä¸»å¹³å°
        function goToMain() {
            window.location.href = '/';
        }

        // åŠ è½½æ‰€æœ‰æ–‡ä»¶
        async function loadFiles() {
            try {
                const response = await fetch('/api/db/files');
                const data = await response.json();
                
                if (data.success) {
                    const selectors = ['file-selector', 'import-file-select', 'export-file-select'];
                    selectors.forEach(selectorId => {
                        const select = document.getElementById(selectorId);
                        select.innerHTML = '<option value="">-- é€‰æ‹©æ–‡ä»¶ --</option>';
                        data.files.forEach(file => {
                            const option = document.createElement('option');
                            option.value = file.display_name;
                            option.textContent = file.display_name;
                            select.appendChild(option);
                        });
                    });
                }
            } catch (error) {
                showAlert('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ–‡ä»¶é€‰æ‹©å˜åŒ–
        async function onFileChange() {
            currentFile = document.getElementById('file-selector').value;
            if (currentFile) {
                currentPage = 1;
                await loadFileInfo();
                await loadFileData();
            } else {
                document.getElementById('data-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>è¯·é€‰æ‹©ä¸€ä¸ªCSVæ–‡ä»¶å¼€å§‹ç®¡ç†</p>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
            }
        }

        // åŠ è½½æ–‡ä»¶ä¿¡æ¯
        async function loadFileInfo() {
            try {
                const response = await fetch(`/api/db/file/info?file=${encodeURIComponent(currentFile)}`);
                const data = await response.json();
                
                if (data.success) {
                    // æ–‡ä»¶ä¿¡æ¯å·²è·å–
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // åŠ è½½æ–‡ä»¶æ•°æ®
        async function loadFileData() {
            if (!currentFile) return;
            
            showLoading(true);
            
            try {
                const url = `/api/db/file/data?file=${encodeURIComponent(currentFile)}&page=${currentPage}&per_page=${perPage}${searchQuery ? '&search=' + encodeURIComponent(searchQuery) : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    displayFileData(data);
                    displayPagination(data);
                    document.getElementById('pagination').style.display = 'flex';
                } else {
                    showAlert('åŠ è½½å¤±è´¥: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶æ•°æ®
        function displayFileData(data) {
            const container = document.getElementById('data-container');
            
            if (data.data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <p>æ²¡æœ‰æ•°æ®</p>
                    </div>
                `;
                return;
            }
            
            const columns = Object.keys(data.data[0]).filter(col => col !== '_index');
            const userRole = '{{ session.role if session.role else "user" }}';
            const isAdmin = userRole === 'admin';
            
            let html = '<div class="data-card">';
            html += '<div class="file-info">';
            html += `<h3>ğŸ“Š ${currentFile}</h3>`;
            html += '<div class="column-tags">';
            columns.forEach(col => {
                html += `<span class="column-tag">${col}</span>`;
            });
            html += '</div></div>';
            
            html += '<div class="data-table-container"><table class="data-table"><thead><tr>';
            columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            
            // åªæœ‰ç®¡ç†å‘˜æ‰æ˜¾ç¤ºæ“ä½œåˆ—
            if (isAdmin) {
                html += '<th>æ“ä½œ</th>';
            }
            html += '</tr></thead><tbody>';
            
            data.data.forEach(row => {
                html += '<tr>';
                columns.forEach(col => {
                    const value = row[col];
                    html += `<td>${value !== null && value !== undefined ? value : ''}</td>`;
                });
                
                // åªæœ‰ç®¡ç†å‘˜æ‰æ˜¾ç¤ºæ“ä½œæŒ‰é’®
                if (isAdmin) {
                    html += `
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-sm" onclick="editRecord(${row._index})" title="ç¼–è¾‘è®°å½•">
                                    âœï¸ ç¼–è¾‘
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteRecord(${row._index})" title="åˆ é™¤è®°å½•">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </td>
                    `;
                }
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div>';
            container.innerHTML = html;
        }

        // æ˜¾ç¤ºåˆ†é¡µ
        function displayPagination(data) {
            const container = document.getElementById('pagination');
            
            container.innerHTML = `
                <button onclick="changePage(1)" ${currentPage === 1 ? 'disabled' : ''}>é¦–é¡µ</button>
                <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
                <span class="page-info">ç¬¬ ${currentPage} é¡µ / å…± ${data.total_pages} é¡µ (æ€»è®¡ ${data.total} æ¡)</span>
                <button onclick="changePage(${currentPage + 1})" ${currentPage === data.total_pages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
                <button onclick="changePage(${data.total_pages})" ${currentPage === data.total_pages ? 'disabled' : ''}>æœ«é¡µ</button>
            `;
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(page) {
            currentPage = page;
            loadFileData();
        }

        // æœç´¢
        let searchTimeout;
        function onSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchQuery = document.getElementById('search-input').value.trim();
                currentPage = 1;
                loadFileData();
            }, 500);
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            loadFileData();
            showAlert('æ•°æ®å·²åˆ·æ–°', 'success');
        }

        // æ˜¾ç¤ºæ·»åŠ è®°å½•æ¨¡æ€æ¡†
        async function showAddRecordModal() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ·»åŠ è®°å½•', 'error');
                return;
            }
            
            if (!currentFile) {
                showAlert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶', 'error');
                return;
            }
            
            currentEditIndex = null;
            document.getElementById('modal-title').textContent = 'æ·»åŠ è®°å½•';
            
            try {
                const response = await fetch(`/api/db/file/info?file=${encodeURIComponent(currentFile)}`);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    generateForm(data.columns);
                    showModal();
                } else {
                    showAlert('åŠ è½½å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶ç»“æ„é”™è¯¯:', error);
                showAlert('åŠ è½½æ–‡ä»¶ç»“æ„å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç¼–è¾‘è®°å½•
        async function editRecord(index) {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥ç¼–è¾‘è®°å½•', 'error');
                return;
            }
            
            currentEditIndex = index;
            document.getElementById('modal-title').textContent = 'âœï¸ ç¼–è¾‘è®°å½•';
            
            try {
                // ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„APIç«¯ç‚¹ /api/db/file/info
                const infoResponse = await fetch(`/api/db/file/info?file=${encodeURIComponent(currentFile)}`);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!infoResponse.ok) {
                    throw new Error(`HTTP ${infoResponse.status}: ${infoResponse.statusText}`);
                }
                
                const infoData = await infoResponse.json();
                
                const dataResponse = await fetch(`/api/db/file/data?file=${encodeURIComponent(currentFile)}&page=1&per_page=10000`);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!dataResponse.ok) {
                    throw new Error(`HTTP ${dataResponse.status}: ${dataResponse.statusText}`);
                }
                
                const fileData = await dataResponse.json();
                
                const record = fileData.data.find(r => r._index === index);
                
                if (infoData.success && record) {
                    generateForm(infoData.columns, record);
                    showModal();
                    showAlert('æ­£åœ¨ç¼–è¾‘ç¬¬ ' + (index + 1) + ' è¡Œè®°å½•', 'info');
                } else {
                    showAlert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„è®°å½•', 'error');
                }
            } catch (error) {
                console.error('ç¼–è¾‘è®°å½•é”™è¯¯:', error);
                showAlert('åŠ è½½è®°å½•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç”Ÿæˆè¡¨å•
        function generateForm(columns, data = null) {
            const formFields = document.getElementById('form-fields');
            formFields.innerHTML = '';
            
            columns.forEach(col => {
                const div = document.createElement('div');
                div.className = 'form-group';
                
                const label = document.createElement('label');
                label.textContent = col;
                div.appendChild(label);
                
                const input = document.createElement('input');
                input.type = 'text';
                input.name = col;
                input.id = 'field-' + col;
                
                if (data && data[col] !== null && data[col] !== undefined) {
                    input.value = data[col];
                }
                
                div.appendChild(input);
                formFields.appendChild(div);
            });
        }

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal() {
            document.getElementById('record-modal').classList.add('show');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('record-modal').classList.remove('show');
            document.getElementById('record-form').reset();
        }

        // å¤„ç†è¡¨å•æäº¤
        document.getElementById('record-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            try {
                let response;
                if (currentEditIndex !== null) {
                    response = await fetch(`/api/db/file/record/${currentEditIndex}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file: currentFile, data: data})
                    });
                } else {
                    response = await fetch(`/api/db/file/record`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file: currentFile, data: data})
                    });
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(currentEditIndex !== null ? 'è®°å½•æ›´æ–°æˆåŠŸ' : 'è®°å½•æ·»åŠ æˆåŠŸ', 'success');
                    closeModal();
                    loadFileData();
                } else {
                    showAlert('æ“ä½œå¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showAlert('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        });

        // åˆ é™¤è®°å½•
        async function deleteRecord(index) {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è®°å½•', 'error');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/db/file/record/${index}?file=${encodeURIComponent(currentFile)}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('è®°å½•åˆ é™¤æˆåŠŸ', 'success');
                    loadFileData();
                } else {
                    showAlert('åˆ é™¤å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showAlert('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('selected-file').textContent = `å·²é€‰æ‹©: ${file.name}`;
            }
        }

        // å¯¼å…¥CSV
        async function importCSV() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥å¯¼å…¥æ•°æ®', 'error');
                return;
            }
            
            const file = document.getElementById('import-file-select').value;
            const fileInput = document.getElementById('csv-file-input');
            
            if (!file) {
                showAlert('è¯·é€‰æ‹©ç›®æ ‡æ–‡ä»¶', 'error');
                return;
            }
            
            if (!fileInput.files[0]) {
                showAlert('è¯·é€‰æ‹©CSVæ–‡ä»¶', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('file', file);
            
            try {
                const response = await fetch(`/api/db/file/import`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${result.rows_imported} æ¡è®°å½•`, 'success');
                    fileInput.value = '';
                    document.getElementById('selected-file').textContent = '';
                    loadFiles();
                } else {
                    showAlert('å¯¼å…¥å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showAlert('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å‡ºCSV
        async function exportCSV() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥å¯¼å‡ºæ•°æ®', 'error');
                return;
            }
            
            const file = document.getElementById('export-file-select').value;
            
            if (!file) {
                showAlert('è¯·é€‰æ‹©è¦å¯¼å‡ºçš„æ–‡ä»¶', 'error');
                return;
            }
            
            try {
                window.location.href = `/api/db/file/export?file=${encodeURIComponent(file)}`;
                showAlert('å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (error) {
                showAlert('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStatistics() {
            try {
                const response = await fetch('/api/db/stats');
                const data = await response.json();
                
                if (data.success) {
                    displayStatistics(data.stats);
                }
            } catch (error) {
                showAlert('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function displayStatistics(stats) {
            const container = document.getElementById('stats-container');
            
            let html = '';
            
            for (let [dirName, dirStats] of Object.entries(stats)) {
                html += `
                    <div class="stat-card">
                        <h3>ğŸ“ ${dirName}</h3>
                        <div class="stat-item">
                            <span class="stat-label">æ–‡ä»¶æ•°é‡</span>
                            <span class="stat-value">${dirStats.file_count}</span>
                        </div>
                `;
                
                dirStats.files.forEach(file => {
                    html += `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e8e8e8;">
                            <div style="font-weight: 600; margin-bottom: 8px;">${file.name}</div>
                            <div class="stat-item">
                                <span class="stat-label">è®°å½•æ•°</span>
                                <span class="stat-value">${file.rows}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å¤§å°</span>
                                <span class="stat-value">${file.size_kb} KB</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ä¿®æ”¹æ—¶é—´</span>
                                <span class="stat-value">${file.modified}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        // æ‰«ææ—§æ–‡ä»¶
        async function scanOldFiles() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰«ææ–‡ä»¶', 'error');
                return;
            }
            
            const period = document.getElementById('cleanup-period').value;
            
            showAlert('æ­£åœ¨æ‰«ææ—§æ–‡ä»¶...', 'info');
            
            try {
                const response = await fetch('/api/db/cleanup/scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({period: period})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    scannedFiles = data.files;
                    displayOldFiles(data.files);
                    showAlert(`æ‰«æå®Œæˆï¼æ‰¾åˆ° ${data.count} ä¸ªæ–‡ä»¶`, 'success');
                } else {
                    showAlert('æ‰«æå¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('æ‰«æå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæ—§æ–‡ä»¶åˆ—è¡¨
        function displayOldFiles(files) {
            const container = document.getElementById('cleanup-results');
            
            if (files.length === 0) {
                container.innerHTML = `
                    <div class="data-card">
                        <div class="empty-state">
                            <div class="empty-state-icon">âœ…</div>
                            <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="data-card"><div class="file-info"><h3>ğŸ“‹ æ‰«æç»“æœ (å…± ' + files.length + ' ä¸ªæ–‡ä»¶)</h3></div>';
            html += '<div class="file-list">';
            
            files.forEach((file, idx) => {
                html += `
                    <div class="file-item">
                        <input type="checkbox" id="file-${idx}" value="${file.full_path}">
                        <div class="file-info-text">
                            <div class="file-name">${file.path}</div>
                            <div class="file-meta">ä¿®æ”¹æ—¶é—´: ${file.modified} | å¤§å°: ${file.size_kb} KB</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div></div>';
            container.innerHTML = html;
        }

        // åˆ é™¤é€‰ä¸­æ–‡ä»¶
        async function deleteSelectedFiles() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤æ–‡ä»¶', 'error');
                return;
            }
            
            const checkboxes = document.querySelectorAll('#cleanup-results input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                showAlert('è¯·é€‰æ‹©è¦åˆ é™¤çš„æ–‡ä»¶', 'error');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checkboxes.length} ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            const files = Array.from(checkboxes).map(cb => cb.value);
            
            try {
                const response = await fetch('/api/db/cleanup/delete', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({files: files})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(`åˆ é™¤æˆåŠŸï¼å…±åˆ é™¤ ${data.deleted_count} ä¸ªæ–‡ä»¶`, 'success');
                    // é‡æ–°æ‰«æ
                    scanOldFiles();
                } else {
                    showAlert('åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ£€æŸ¥æŸåæ–‡ä»¶
        async function checkCorruptedFiles() {
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            const userRole = '{{ session.role if session.role else "user" }}';
            if (userRole !== 'admin') {
                showAlert('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ£€æŸ¥æ–‡ä»¶', 'error');
                return;
            }
            
            showAlert('æ­£åœ¨æ£€æŸ¥æŸåæ–‡ä»¶...', 'info');
            
            try {
                const response = await fetch('/api/db/cleanup/check_corrupted');
                const data = await response.json();
                
                if (data.success) {
                    displayCorruptedFiles(data.files);
                    if (data.count === 0) {
                        showAlert('æ‰€æœ‰CSVæ–‡ä»¶éƒ½æ­£å¸¸ï¼', 'success');
                    } else {
                        showAlert(`å‘ç° ${data.count} ä¸ªæŸåæˆ–æœ‰é—®é¢˜çš„æ–‡ä»¶`, 'error');
                    }
                }
            } catch (error) {
                showAlert('æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæŸåæ–‡ä»¶
        function displayCorruptedFiles(files) {
            const container = document.getElementById('cleanup-results');
            
            if (files.length === 0) {
                container.innerHTML = `
                    <div class="data-card">
                        <div class="empty-state">
                            <div class="empty-state-icon">âœ…</div>
                            <p>æ‰€æœ‰æ–‡ä»¶æ£€æŸ¥æ­£å¸¸ï¼Œæœªå‘ç°æŸåæ–‡ä»¶</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç»„
            const filesByType = {};
            files.forEach(file => {
                const type = file.type || 'å…¶ä»–';
                if (!filesByType[type]) {
                    filesByType[type] = [];
                }
                filesByType[type].push(file);
            });
            
            let html = '<div class="data-card"><div class="file-info">';
            html += `<h3>âš ï¸ æŸåæ–‡ä»¶æ£€æµ‹ç»“æœ (å…± ${files.length} ä¸ªé—®é¢˜)</h3>`;
            html += '<p style="color: #666; margin-top: 10px;">æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç»„æ˜¾ç¤º</p>';
            html += '</div>';
            
            // æŒ‰ç±»å‹æ˜¾ç¤º
            for (const [type, typeFiles] of Object.entries(filesByType)) {
                html += `<div style="padding: 20px; border-top: 1px solid #e8e8e8;">`;
                html += `<h4 style="color: #3a86ff; margin-bottom: 15px;">ğŸ“Œ ${type} æ–‡ä»¶ (${typeFiles.length})</h4>`;
                html += '<div class="file-list">';
                
                typeFiles.forEach((file) => {
                    html += `
                        <div class="file-item">
                            <div class="file-info-text" style="flex: 1;">
                                <div class="file-name">${file.path}</div>
                                <div class="file-meta" style="color: #ff6b6b;">âŒ ${file.error}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }

        // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }
    </script>
</body>
</html>
